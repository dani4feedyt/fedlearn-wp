<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>In-Page Federated Learning System</title>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 25px;
    }

    #drawCanvas {
      border: 2px solid #333;
      background: white;
      touch-action: none;
    }

    #mnistPreview {
      border: 2px solid #333;
      /*margin-top: 10px;*/
    }

    .section {
      margin-top: 50px;
      padding: 15px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }

    .centered-flex {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 32px;
    }

    button {
      margin-right: 10px;
      margin-top: 5px;
      padding: 8px 14px;
    }
  </style>
</head>

<body>

  <h2 class="centered-flex">In-Page Federated Learning</h2>
  <div id="status" class="centered-flex"><b>Status:</b> idle</div>

  <div class="section">
    <h3>Draw a Digit (0–9)</h3>
    <div style="display:flex; gap:32px; align-items:flex-start;">

      <div style="display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; flex-direction:row; gap:12px;">
          <canvas id="drawCanvas" width="280" height="280"></canvas>
          <canvas id="mnistPreview" width="280" height="280"></canvas>
        </div>
          <div style="display:flex; flex-direction:row; gap:12px;">
            <button id="predictBtn" style="width:280px; height:40px;">Predict Drawn Digit</button>
            <button id="clearBtn" style="width:280px; height:40px;">Clear</button>
          </div>
      </div>

      <div id="prediction_body" style="display:flex; flex-direction:column; gap:18px;">

        <div id="prediction" style="font-size:1.6em; font-weight:bold;"></div>

        <div id="feedbackArea" style="display:none; flex-direction:column; gap:10px;">
          <div>
            <strong>Last prediction:</strong>
            <span id="lastPredictionText"></span>
          </div>

          <div style="display:flex; align-items:center; gap:8px;">
            <label>Is predicted number correct?</label>
            <button id="feedbackYesBtn">Yes</button>
            <button id="feedbackNoBtn">No</button>
          </div>

          <span id="correctionUI" style="display:none; align-items:center; gap:8px;">
            Correct label:
            <input id="correctLabelInput" type="number" min="0" max="9" style="width:60px;">
            <button id="submitCorrectionBtn">Submit</button>
          </span>
        </div>

      </div>
    </div>
  </div>

  <div class="section">
    <h3>Model Accuracy between rounds</h3>
    <div id="lastUpdated" style="margin-top:6px; font-size:0.85em; color:#555;">
        Last updated: never
    </div>

    <canvas id="accuracyChart" width="700" height="280" style="border:1px solid #333;"></canvas>

    <div style="margin-top:8px; font-size:0.9em;">
      Community evaluated accuracy (latest): <span id="userAccDisplay">N/A</span>
      &nbsp;|&nbsp; MNIST accuracy (latest): <span id="mnistAccDisplay">N/A</span>
      Model size:<span id="modelSize"> 0 KB</span>
    </div>
    <div id="roundInfo">
      <strong>Round:</strong> <span id="roundNumber">?</span><br>
      <strong>Next round in:</strong> <span id="countdown">?</span> sec
      <strong>Previous Round Status:</strong>
      <span id="prevStatus">No previous rounds yet, or model was initialized one round ago.</span>
    </div>
  </div>

  <script src="client.js?v=202512075"></script> <!--Change v= to immediately enforce new non-cached js -->
  </body>
</html>
